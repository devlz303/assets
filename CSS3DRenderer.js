THREE.CSS3DObject=function(e){THREE.Object3D.call(this),this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof Element&&null!==e.element.parentNode&&e.element.parentNode.removeChild(e.element)})})},THREE.CSS3DObject.prototype=Object.create(THREE.Object3D.prototype),THREE.CSS3DObject.prototype.constructor=THREE.CSS3DObject,THREE.CSS3DSprite=function(e){THREE.CSS3DObject.call(this,e)},THREE.CSS3DSprite.prototype=Object.create(THREE.CSS3DObject.prototype),THREE.CSS3DSprite.prototype.constructor=THREE.CSS3DSprite,THREE.CSS3DRenderer=function(){var e,t,r,n,a=this,s=new THREE.Matrix4,i={camera:{fov:0,style:""},objects:new WeakMap},o=document.createElement("div");o.style.overflow="hidden",this.domElement=o;var l=document.createElement("div");l.style.WebkitTransformStyle="preserve-3d",l.style.transformStyle="preserve-3d",l.style.pointerEvents="none",o.appendChild(l);var c=/Trident/i.test(navigator.userAgent);function p(e){return 1e-10>Math.abs(e)?0:e}function d(e){var t=e.elements;return"matrix3d("+p(t[0])+","+p(-t[1])+","+p(t[2])+","+p(t[3])+","+p(t[4])+","+p(-t[5])+","+p(t[6])+","+p(t[7])+","+p(t[8])+","+p(-t[9])+","+p(t[10])+","+p(t[11])+","+p(t[12])+","+p(-t[13])+","+p(t[14])+","+p(t[15])+")"}function m(e,t){var a=e.elements,s="matrix3d("+p(a[0])+","+p(a[1])+","+p(a[2])+","+p(a[3])+","+p(-a[4])+","+p(-a[5])+","+p(-a[6])+","+p(-a[7])+","+p(a[8])+","+p(a[9])+","+p(a[10])+","+p(a[11])+","+p(a[12])+","+p(a[13])+","+p(a[14])+","+p(a[15])+")";return c?"translate(-50%,-50%)translate("+r+"px,"+n+"px)"+t+s:"translate(-50%,-50%)"+s}this.getSize=function(){return{width:e,height:t}},this.setSize=function(a,s){e=a,t=s,r=e/2,n=t/2,o.style.width=a+"px",o.style.height=s+"px",l.style.width=a+"px",l.style.height=s+"px"};var S,f,v=(S=new THREE.Vector3,f=new THREE.Vector3,function(e,t){return S.setFromMatrixPosition(e.matrixWorld),f.setFromMatrixPosition(t.matrixWorld),S.distanceToSquared(f)});this.render=function(e,t){var S=t.projectionMatrix.elements[5]*n;if(i.camera.fov!==S&&(t.isPerspectiveCamera?(o.style.WebkitPerspective=S+"px",o.style.perspective=S+"px"):(o.style.WebkitPerspective="",o.style.perspective=""),i.camera.fov=S),!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),t.isOrthographicCamera)var f=-(t.right+t.left)/2,u=(t.top+t.bottom)/2;var h=t.isOrthographicCamera?"scale("+S+")translate("+p(f)+"px,"+p(u)+"px)"+d(t.matrixWorldInverse):"translateZ("+S+"px)"+d(t.matrixWorldInverse),y=h+"translate("+r+"px,"+n+"px)";i.camera.style===y||c||(l.style.WebkitTransform=y,l.style.transform=y,i.camera.style=y),function e(t,r,n,o){if(t instanceof THREE.CSS3DObject){t.onBeforeRender(a,r,n),t instanceof THREE.CSS3DSprite?(s.copy(n.matrixWorldInverse),s.transpose(),s.copyPosition(t.matrixWorld),s.scale(t.scale),s.elements[3]=0,s.elements[7]=0,s.elements[11]=0,s.elements[15]=1,p=m(s,o)):p=m(t.matrixWorld,o);var p,d=t.element,S=i.objects.get(t);if(void 0===S||S.style!==p){d.style.WebkitTransform=p,d.style.transform=p;var f={style:p};c&&(f.distanceToCameraSquared=v(n,t)),i.objects.set(t,f)}d.parentNode!==l&&l.appendChild(d),t.onAfterRender(a,r,n)}for(var u=0,h=t.children.length;u<h;u++)e(t.children[u],r,n,o)}(e,e,t,h),c&&function e(t){for(var r,n,a=(r=t,n=[],r.traverse(function(e){e instanceof THREE.CSS3DObject&&n.push(e)}),n).sort(function(e,t){var r;return i.objects.get(e).distanceToCameraSquared-i.objects.get(t).distanceToCameraSquared}),s=a.length,o=0,l=a.length;o<l;o++)a[o].element.style.zIndex=s-o}(e)}};