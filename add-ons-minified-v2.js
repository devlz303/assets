const EventDispatcher=THREE.EventDispatcher,MOUSE=THREE.MOUSE,Quaternion=THREE.Quaternion,Spherical=THREE.Spherical,TOUCH=THREE.TOUCH,Vector2=THREE.Vector2,Vector3=THREE.Vector3,_changeEvent={type:"change"},_startEvent={type:"start"},_endEvent={type:"end"};class OrbitControls extends EventDispatcher{constructor(t,e){super(),this.object=t,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:MOUSE.ROTATE,MIDDLE:MOUSE.DOLLY,RIGHT:MOUSE.PAN},this.touches={ONE:TOUCH.ROTATE,TWO:TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return o.phi},this.getAzimuthalAngle=function(){return o.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",te),this._domElementKeyEvents=t},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",te),this._domElementKeyEvents=null},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(_changeEvent),n.update(),r=i.NONE},this.update=function(){let e=new Vector3,h=new Quaternion().setFromUnitVectors(t.up,new Vector3(0,1,0)),d=h.clone().invert(),p=new Vector3,f=new Quaternion,m=2*Math.PI;return function t(){let v=n.object.position;e.copy(v).sub(n.target),e.applyQuaternion(h),o.setFromVector3(e),n.autoRotate&&r===i.NONE&&S(b()),n.enableDamping?(o.theta+=s.theta*n.dampingFactor,o.phi+=s.phi*n.dampingFactor):(o.theta+=s.theta,o.phi+=s.phi);let g=n.minAzimuthAngle,$=n.maxAzimuthAngle;return isFinite(g)&&isFinite($)&&(g<-Math.PI?g+=m:g>Math.PI&&(g-=m),$<-Math.PI?$+=m:$>Math.PI&&($-=m),g<=$?o.theta=Math.max(g,Math.min($,o.theta)):o.theta=o.theta>(g+$)/2?Math.max(g,o.theta):Math.min($,o.theta)),o.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,o.phi)),o.makeSafe(),o.radius*=l,o.radius=Math.max(n.minDistance,Math.min(n.maxDistance,o.radius)),!0===n.enableDamping?n.target.addScaledVector(u,n.dampingFactor):n.target.add(u),e.setFromSpherical(o),e.applyQuaternion(d),v.copy(n.target).add(e),n.object.lookAt(n.target),!0===n.enableDamping?(s.theta*=1-n.dampingFactor,s.phi*=1-n.dampingFactor,u.multiplyScalar(1-n.dampingFactor)):(s.set(0,0,0),u.set(0,0,0)),l=1,!!(c||p.distanceToSquared(n.object.position)>a||8*(1-f.dot(n.object.quaternion))>a)&&(n.dispatchEvent(_changeEvent),p.copy(n.object.position),f.copy(n.object.quaternion),c=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",tr),n.domElement.removeEventListener("pointerdown",Y),n.domElement.removeEventListener("pointercancel",J),n.domElement.removeEventListener("wheel",tt),n.domElement.removeEventListener("pointermove",Z),n.domElement.removeEventListener("pointerup",J),null!==n._domElementKeyEvents&&(n._domElementKeyEvents.removeEventListener("keydown",te),n._domElementKeyEvents=null)};let n=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},r=i.NONE,a=1e-6,o=new Spherical,s=new Spherical,l=1,u=new Vector3,c=!1,h=new Vector2,d=new Vector2,p=new Vector2,f=new Vector2,m=new Vector2,v=new Vector2,g=new Vector2,$=new Vector2,y=new Vector2,x=[],_={};function b(){return 2*Math.PI/60/60*n.autoRotateSpeed}function w(){return Math.pow(.95,n.zoomSpeed)}function S(t){s.theta-=t}function M(t){s.phi-=t}let T=function(){let t=new Vector3;return function e(n,i){t.setFromMatrixColumn(i,0),t.multiplyScalar(-n),u.add(t)}}(),E=function(){let t=new Vector3;return function e(i,r){!0===n.screenSpacePanning?t.setFromMatrixColumn(r,1):(t.setFromMatrixColumn(r,0),t.crossVectors(n.object.up,t)),t.multiplyScalar(i),u.add(t)}}(),A=function(){let t=new Vector3;return function e(i,r){let a=n.domElement;if(n.object.isPerspectiveCamera){let o=n.object.position;t.copy(o).sub(n.target);let s=t.length();T(2*i*(s*=Math.tan(n.object.fov/2*Math.PI/180))/a.clientHeight,n.object.matrix),E(2*r*s/a.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(T(i*(n.object.right-n.object.left)/n.object.zoom/a.clientWidth,n.object.matrix),E(r*(n.object.top-n.object.bottom)/n.object.zoom/a.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function L(t){n.object.isPerspectiveCamera?l/=t:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*t)),n.object.updateProjectionMatrix(),c=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function R(t){n.object.isPerspectiveCamera?l*=t:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/t)),n.object.updateProjectionMatrix(),c=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function P(t){h.set(t.clientX,t.clientY)}function C(t){g.set(t.clientX,t.clientY)}function D(t){f.set(t.clientX,t.clientY)}function I(t){d.set(t.clientX,t.clientY),p.subVectors(d,h).multiplyScalar(n.rotateSpeed);let e=n.domElement;S(2*Math.PI*p.x/e.clientHeight),M(2*Math.PI*p.y/e.clientHeight),h.copy(d),n.update()}function N(t){$.set(t.clientX,t.clientY),y.subVectors($,g),y.y>0?L(w()):y.y<0&&R(w()),g.copy($),n.update()}function B(t){m.set(t.clientX,t.clientY),v.subVectors(m,f).multiplyScalar(n.panSpeed),A(v.x,v.y),f.copy(m),n.update()}function z(t){t.deltaY<0?R(w()):t.deltaY>0&&L(w()),n.update()}function U(t){let e=!1;switch(t.code){case n.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?M(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):A(0,n.keyPanSpeed),e=!0;break;case n.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?M(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):A(0,-n.keyPanSpeed),e=!0;break;case n.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?S(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):A(n.keyPanSpeed,0),e=!0;break;case n.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?S(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):A(-n.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),n.update())}function G(){if(1===x.length)h.set(x[0].pageX,x[0].pageY);else{let t=.5*(x[0].pageX+x[1].pageX),e=.5*(x[0].pageY+x[1].pageY);h.set(t,e)}}function O(){if(1===x.length)f.set(x[0].pageX,x[0].pageY);else{let t=.5*(x[0].pageX+x[1].pageX),e=.5*(x[0].pageY+x[1].pageY);f.set(t,e)}}function H(){let t=x[0].pageX-x[1].pageX,e=x[0].pageY-x[1].pageY,n=Math.sqrt(t*t+e*e);g.set(0,n)}function F(){n.enableZoom&&H(),n.enablePan&&O()}function k(){n.enableZoom&&H(),n.enableRotate&&G()}function V(t){if(1==x.length)d.set(t.pageX,t.pageY);else{let e=tl(t),i=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);d.set(i,r)}p.subVectors(d,h).multiplyScalar(n.rotateSpeed);let a=n.domElement;S(2*Math.PI*p.x/a.clientHeight),M(2*Math.PI*p.y/a.clientHeight),h.copy(d)}function W(t){if(1===x.length)m.set(t.pageX,t.pageY);else{let e=tl(t),i=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);m.set(i,r)}v.subVectors(m,f).multiplyScalar(n.panSpeed),A(v.x,v.y),f.copy(m)}function j(t){let e=tl(t),i=t.pageX-e.x,r=t.pageY-e.y,a=Math.sqrt(i*i+r*r);$.set(0,a),y.set(0,Math.pow($.y/g.y,n.zoomSpeed)),L(y.y),g.copy($)}function q(t){n.enableZoom&&j(t),n.enablePan&&W(t)}function X(t){n.enableZoom&&j(t),n.enableRotate&&V(t)}function Y(t){!1!==n.enabled&&(0===x.length&&(n.domElement.setPointerCapture(t.pointerId),n.domElement.addEventListener("pointermove",Z),n.domElement.addEventListener("pointerup",J)),ta(t),"touch"===t.pointerType?tn(t):K(t))}function Z(t){!1!==n.enabled&&("touch"===t.pointerType?ti(t):Q(t))}function J(t){to(t),0===x.length&&(n.domElement.releasePointerCapture(t.pointerId),n.domElement.removeEventListener("pointermove",Z),n.domElement.removeEventListener("pointerup",J)),n.dispatchEvent(_endEvent),r=i.NONE}function K(t){let e;switch(t.button){case 0:e=n.mouseButtons.LEFT;break;case 1:e=n.mouseButtons.MIDDLE;break;case 2:e=n.mouseButtons.RIGHT;break;default:e=-1}switch(e){case MOUSE.DOLLY:if(!1===n.enableZoom)return;C(t),r=i.DOLLY;break;case MOUSE.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enablePan)return;D(t),r=i.PAN}else{if(!1===n.enableRotate)return;P(t),r=i.ROTATE}break;case MOUSE.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enableRotate)return;P(t),r=i.ROTATE}else{if(!1===n.enablePan)return;D(t),r=i.PAN}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(_startEvent)}function Q(t){switch(r){case i.ROTATE:if(!1===n.enableRotate)return;I(t);break;case i.DOLLY:if(!1===n.enableZoom)return;N(t);break;case i.PAN:if(!1===n.enablePan)return;B(t)}}function tt(t){!1!==n.enabled&&!1!==n.enableZoom&&r===i.NONE&&(t.preventDefault(),n.dispatchEvent(_startEvent),z(t),n.dispatchEvent(_endEvent))}function te(t){!1!==n.enabled&&!1!==n.enablePan&&U(t)}function tn(t){switch(ts(t),x.length){case 1:switch(n.touches.ONE){case TOUCH.ROTATE:if(!1===n.enableRotate)return;G(),r=i.TOUCH_ROTATE;break;case TOUCH.PAN:if(!1===n.enablePan)return;O(),r=i.TOUCH_PAN;break;default:r=i.NONE}break;case 2:switch(n.touches.TWO){case TOUCH.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;F(),r=i.TOUCH_DOLLY_PAN;break;case TOUCH.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;k(),r=i.TOUCH_DOLLY_ROTATE;break;default:r=i.NONE}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(_startEvent)}function ti(t){switch(ts(t),r){case i.TOUCH_ROTATE:if(!1===n.enableRotate)return;V(t),n.update();break;case i.TOUCH_PAN:if(!1===n.enablePan)return;W(t),n.update();break;case i.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;q(t),n.update();break;case i.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;X(t),n.update();break;default:r=i.NONE}}function tr(t){!1!==n.enabled&&t.preventDefault()}function ta(t){x.push(t)}function to(t){delete _[t.pointerId];for(let e=0;e<x.length;e++)if(x[e].pointerId==t.pointerId){x.splice(e,1);return}}function ts(t){let e=_[t.pointerId];void 0===e&&(e=new Vector2,_[t.pointerId]=e),e.set(t.pageX,t.pageY)}function tl(t){let e=t.pointerId===x[0].pointerId?x[1]:x[0];return _[e.pointerId]}n.domElement.addEventListener("contextmenu",tr),n.domElement.addEventListener("pointerdown",Y),n.domElement.addEventListener("pointercancel",J),n.domElement.addEventListener("wheel",tt,{passive:!1}),this.update()}}const Matrix4=THREE.Matrix4,Object3D=THREE.Object3D,_position=new Vector3,_quaternion=new Quaternion,_scale=new Vector3;class CSS3DObject extends Object3D{constructor(t=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&null!==t.element.parentNode&&t.element.parentNode.removeChild(t.element)})})}copy(t,e){return super.copy(t,e),this.element=t.element.cloneNode(!0),this}}class CSS3DSprite extends CSS3DObject{constructor(t){super(t),this.isCSS3DSprite=!0,this.rotation2D=0}copy(t,e){return super.copy(t,e),this.rotation2D=t.rotation2D,this}}const _matrix=new Matrix4,_matrix2=new Matrix4;class CSS3DRenderer{constructor(t={}){let e=this,n,i,r,a,o={camera:{fov:0,style:""},objects:new WeakMap},s=void 0!==t.element?t.element:document.createElement("div");s.style.overflow="hidden",this.domElement=s;let l=document.createElement("div");l.style.transformOrigin="0 0",l.style.pointerEvents="none",s.appendChild(l);let u=document.createElement("div");function c(t){return 1e-10>Math.abs(t)?0:t}function h(t){let e=t.elements;return"matrix3d("+c(e[0])+","+c(-e[1])+","+c(e[2])+","+c(e[3])+","+c(e[4])+","+c(-e[5])+","+c(e[6])+","+c(e[7])+","+c(e[8])+","+c(-e[9])+","+c(e[10])+","+c(e[11])+","+c(e[12])+","+c(-e[13])+","+c(e[14])+","+c(e[15])+")"}function d(t){let e=t.elements,n="matrix3d("+c(e[0])+","+c(e[1])+","+c(e[2])+","+c(e[3])+","+c(-e[4])+","+c(-e[5])+","+c(-e[6])+","+c(-e[7])+","+c(e[8])+","+c(e[9])+","+c(e[10])+","+c(e[11])+","+c(e[12])+","+c(e[13])+","+c(e[14])+","+c(e[15])+")";return"translate(-50%,-50%)"+n}function p(t,n,i,r){if(t.isCSS3DObject){let a=!0===t.visible&&!0===t.layers.test(i.layers);if(t.element.style.display=!0===a?"":"none",!0===a){t.onBeforeRender(e,n,i);let s;t.isCSS3DSprite?(_matrix.copy(i.matrixWorldInverse),_matrix.transpose(),0!==t.rotation2D&&_matrix.multiply(_matrix2.makeRotationZ(t.rotation2D)),t.matrixWorld.decompose(_position,_quaternion,_scale),_matrix.setPosition(_position),_matrix.scale(_scale),_matrix.elements[3]=0,_matrix.elements[7]=0,_matrix.elements[11]=0,_matrix.elements[15]=1,s=d(_matrix)):s=d(t.matrixWorld);let l=t.element,c=o.objects.get(t);if(void 0===c||c.style!==s){l.style.transform=s;let h={style:s};o.objects.set(t,h)}l.parentNode!==u&&u.appendChild(l),t.onAfterRender(e,n,i)}}for(let f=0,m=t.children.length;f<m;f++)p(t.children[f],n,i,r)}u.style.transformStyle="preserve-3d",l.appendChild(u),this.getSize=function(){return{width:n,height:i}},this.render=function(t,e){let s=e.projectionMatrix.elements[5]*a;o.camera.fov!==s&&(l.style.perspective=e.isPerspectiveCamera?s+"px":"",o.camera.fov=s),e.view&&e.view.enabled?(l.style.transform=`translate( ${-e.view.offsetX*(n/e.view.width)}px, ${-e.view.offsetY*(i/e.view.height)}px )`,l.style.transform+=`scale( ${e.view.fullWidth/e.view.width}, ${e.view.fullHeight/e.view.height} )`):l.style.transform="",!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld();let d,f;e.isOrthographicCamera&&(d=-(e.right+e.left)/2,f=(e.top+e.bottom)/2);let m=e.view&&e.view.enabled?e.view.height/e.view.fullHeight:1,v=e.isOrthographicCamera?`scale( ${m} )scale(`+s+")translate("+c(d)+"px,"+c(f)+"px)"+h(e.matrixWorldInverse):`scale( ${m} )translateZ(`+s+"px)"+h(e.matrixWorldInverse),g=v+"translate("+r+"px,"+a+"px)";o.camera.style!==g&&(u.style.transform=g,o.camera.style=g),p(t,t,e,v)},this.setSize=function(t,e){n=t,i=e,r=n/2,a=i/2,s.style.width=t+"px",s.style.height=e+"px",l.style.width=t+"px",l.style.height=e+"px",u.style.width=t+"px",u.style.height=e+"px"}}}